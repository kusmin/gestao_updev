name: Snyk Security Scan

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  snyk:
    name: Snyk Scan
    runs-on: ubuntu-latest
    permissions:
      contents: read
    env:
      SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
    steps:
      - uses: actions/checkout@v5

      - uses: actions/setup-go@v5
        with:
          go-version: '1.25'

      - name: Install Snyk CLI
        run: npm install -g snyk

      - name: Scan backend (Go modules)
        working-directory: backend
        run: snyk test --file=go.mod --package-manager=gomod --severity-threshold=medium

      - name: Scan frontend dependencies
        working-directory: frontend
        run: snyk test --file=package.json --package-manager=npm --severity-threshold=medium

      - name: Scan backoffice dependencies
        working-directory: backoffice
        run: snyk test --file=package.json --package-manager=npm --severity-threshold=medium

      - name: Scan e2e test dependencies
        working-directory: tests/e2e
        run: snyk test --file=package.json --package-manager=npm --severity-threshold=medium

      - name: Scan Postman test dependencies
        working-directory: tests/postman
        run: snyk test --file=package.json --package-manager=npm --severity-threshold=medium
